<app-navbar></app-navbar>

<section class="w-full min-h-screen flex bg-gray-50 anuphan-regular">
  <!-- Sidebar -->
  <aside class="min-w-64 bg-white border-r border-gray-200 shadow-sm p-6 hidden md:block">
    <h2 class="text-md font-semibold mb-6 text-gray-700 border-b border-black">My Account</h2>
    <ul class="space-y-4">
      <li >
        <a  routerLink="/profile" routerLinkActive="bg-gray-100 text-black font-semibold rounded-lg px-3 py-2"
        [routerLinkActiveOptions]="{ exact: true }"
        class="flex items-center gap-1 text-gray-600 hover:text-black transition-all px-3 py-2 rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M5.121 17.804A4 4 0 018 16h8a4 4 0 012.879 1.804M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg> Profile Information</a>
      </li>
      <li>
        <a class="flex items-center gap-1"  routerLink="/bank-account" routerLinkActive="bg-gray-100 text-black font-semibold rounded-lg px-3 py-2"
        [routerLinkActiveOptions]="{ exact: true }"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M3 10h18M5 6h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2z" />
        </svg>
         Bank Account</a>
      </li>
      <li>
        <a class="flex items-center gap-1"  routerLink="/order-history" routerLinkActive="bg-gray-100 text-black font-semibold rounded-lg px-3 py-2"
        [routerLinkActiveOptions]="{ exact: true }"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"  viewBox="0 0 24 24">
          <path d="M 5.75 3 A 1.0001 1.0001 0 0 0 4.8867188 3.4960938 L 3.1367188 6.4960938 A 1.0001 1.0001 0 0 0 3 7 L 3 19 C 3 20.093063 3.9069372 21 5 21 L 19 21 C 20.093063 21 21 20.093063 21 19 L 21 7 A 1.0001 1.0001 0 0 0 20.863281 6.4960938 L 19.113281 3.4960938 A 1.0001 1.0001 0 0 0 18.25 3 L 5.75 3 z M 6.3242188 5 L 17.675781 5 L 18.841797 7 L 5.1582031 7 L 6.3242188 5 z M 5 9 L 19 9 L 19 19 L 5 19 L 5 9 z M 9 11 L 9 13 L 15 13 L 15 11 L 9 11 z"></path>
          </svg>
         Order History</a>
      </li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="flex-grow p-6">
      <!-- Profile Card -->
      <div class="bg-white shadow-xl rounded-3xl w-full p-8">
        <div class="flex flex-col lg:flex-row gap-10 items-center">
          <!-- Profile Picture -->
          <div class="flex flex-col items-center">
            @if(imageUrl){
            <img width="200" [src]="imageUrl" alt="Profile Picture"
              class="w-48 h-48 object-cover rounded-full shadow-lg border border-gray-300" />
            }@else{
            <div
              class="w-48 h-48 bg-gray-100 rounded-full flex justify-center items-center shadow-lg border border-gray-300">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-gray-300 w-20 h-20">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 2a5 5 0 1 1 -5 5l.005 -.217a5 5 0 0 1 4.995 -4.783z" />
                <path d="M14 14a5 5 0 0 1 5 5v1a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-1a5 5 0 0 1 5 -5h4z" />
              </svg>
            </div>
            }
            <label for="upload-profile" class="btn btn-sm mt-4 btn-primary">Change Profile Picture</label>
            <input id="upload-profile" type="file" (change)="onFileSelected($event)" accept="image/*" class="hidden" />
          </div>

          <!-- Profile Form -->
          <form *ngIf="!isLoading" [formGroup]="profileForm" (ngSubmit)="updateUser()"
            class="flex-1 bg-white p-6 rounded-2xl shadow-md border">
            <div class="pb-4 text-lg text-bold text-gray-600">User information</div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <label class="form-control w-full">
                <span class="label-text">Username</span>
                <input formControlName="username" class="input input-bordered w-full" />
              </label>
              <label class="form-control w-full">
                <span class="label-text">Email</span>
                <input formControlName="email" class="input input-bordered w-full" />
              </label>
              <label class="form-control w-full">
                <span class="label-text">First Name</span>
                <input formControlName="firstname" class="input input-bordered w-full" />
              </label>
              <label class="form-control w-full">
                <span class="label-text">Last Name</span>
                <input formControlName="lastname" class="input input-bordered w-full" />
              </label>
              <label class="form-control w-full">
                <span class="label-text">Phone Number</span>
                <input formControlName="phone_number" class="input input-bordered w-full" />
              </label>
              <label class="form-control w-full">
                <span class="label-text">Birth Date</span>
                <input formControlName="birth_date" type="date" class="input input-bordered w-full" />
              </label>
            </div>

            <div class="divider divider-primary pt-4"> & </div>
            <div class="text-lg text-bold pb-4 text-gray-600">Address information</div>

            <div formArrayName="addresses" class="grid gap-4">
              <div *ngFor="let addressGroup of getAddressControls(); let i = index" [formGroupName]="i"
                   class="border rounded-xl shadow-sm bg-white">
                <div class="flex justify-between items-center bg-gray-100 px-4 py-3 rounded-t-xl cursor-pointer"
                     (click)="toggleExpand(i)">
                  <div class="text-sm font-medium text-gray-700">Address {{ i + 1 }}</div>
                  <div class="text-sm text-blue-500">{{ expandedAddressIndex === i ? 'Hide' : 'Edit' }}</div>
                </div>

                <div *ngIf="expandedAddressIndex === i" class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                  <label class="form-control w-full">
                    <span class="label-text">House Number</span>
                    <input class="input input-bordered w-full" formControlName="houseNumber" />
                  </label>
                  <label class="form-control w-full">
                    <span class="label-text">Building</span>
                    <input class="input input-bordered w-full" formControlName="building" />
                  </label>
                  <label class="form-control w-full">
                    <span class="label-text">Street</span>
                    <input class="input input-bordered w-full" formControlName="street" />
                  </label>
                  <label class="form-control w-full">
                    <span class="label-text">Subdistrict</span>
                    <input class="input input-bordered w-full" formControlName="subDistrict" />
                  </label>
                  <label class="form-control w-full">
                    <span class="label-text">District</span>
                    <input class="input input-bordered w-full" formControlName="district" />
                  </label>
                  <label class="form-control w-full">
                    <span class="label-text">Province</span>
                    <input class="input input-bordered w-full" formControlName="province" />
                  </label>
                  <label class="form-control w-full">
                    <span class="label-text">Postal Code</span>
                    <input class="input input-bordered w-full" formControlName="postalCode" />
                  </label>
                  <label class="form-control w-full">
                    <span class="label-text">Country</span>
                    <input class="input input-bordered w-full" formControlName="country" />
                  </label>
                  <label class="form-control w-full">
                    <span class="label-text">Address Type</span>
                    <select class="select select-bordered w-full" formControlName="addressType">
                      <option value="home">Home</option>
                      <option value="work">Work</option>
                      <option value="other">Other</option>
                    </select>
                  </label>

                  <div class="flex justify-end md:col-span-2">
                    <button class="btn btn-error btn-sm" type="button" (click)="removeAddress(i)">Remove</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex justify-end mt-6 gap-4">
              <button type="button" class="btn btn-outline btn-primary" (click)="addAddress()">+ Add Address</button>
              <button type="submit" class="btn btn-primary shadow-md hover:bg-blue-600">Save Changes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Toast Notification -->
      <div id="toast" class="toast toast-top toast-end z-50">
        <div *ngIf="showToast" class="alert alert-success shadow-lg text-md text-white">
          <span class="flex items-center gap-4">
            <svg fill="#ffffff" width="12px" height="12px" viewBox="0 0 335.765 335.765"
            xmlns="http://www.w3.org/2000/svg">
              <polygon points="311.757,41.803 107.573,245.96 23.986,162.364 0,186.393 107.573,293.962 335.765,65.795"></polygon>
            </svg>
            Profile updated successfully!
          </span>
        </div>
      </div>
  </main>
</section>
