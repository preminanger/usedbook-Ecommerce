<app-navbar></app-navbar>
<section class="w-full min-h-screen flex bg-gray-100 anuphan-regular">
  <!-- Side Navigation -->
  <aside class="min-w-64 bg-white border-r border-gray-200 shadow-sm p-6 hidden md:block">
    <h2 class="text-md font-semibold mb-6 text-gray-700 border-b border-black">Dashboard</h2>
    <ul class="space-y-2">
      <!-- Add Product -->
      <li>
        <a routerLink="/my-item" routerLinkActive="bg-gray-100 text-black font-semibold rounded-lg px-3 py-2"
          [routerLinkActiveOptions]="{ exact: true }"
          class="flex items-center gap-2 text-gray-600 hover:text-black transition-all px-3 py-2 rounded-lg">

          <!-- Plus Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          Add Product
        </a>
      </li>
      <!-- My Product -->
      <li>
        <a routerLink="/my-product" routerLinkActive="bg-gray-100 text-black font-semibold rounded-lg px-3 py-2"
          [routerLinkActiveOptions]="{ exact: true }"
          class="flex items-center gap-2 text-gray-600 hover:text-black transition-all px-3 py-2 rounded-lg">
          <!-- Box Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 7l9-4 9 4M3 7v7a2 2 0 002 2h3m10-9v7a2 2 0 01-2 2h-3m-4 0v4m0 0h4m-4 0H7" />
          </svg>
          My Product
        </a>
      </li>
    </ul>
  </aside>
  <!-- Main Content -->
  <main class="flex-grow p-10 h-full">
    <div class="flex flex-row w-full h-full ">
      <div class="flex-grow bg-white p-8 shadow-2xl rounded-3xl border border-gray-200 h-[90%] ">
        <form #formRef="ngForm" (ngSubmit)="onSubmit()" enctype="multipart/form-data" class="space-y-5">
          <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col gap-5 items-center">
              <div class="form-control w-full">
                <label class="label">
                  <span class="label-text text-lg font-semibold">Upload Book Images</span>
                  <span class="label-text-alt text-sm text-gray-500">(You can select multiple images)</span>
                </label>

                <input type="file" class="file-input file-input-bordered w-full" (change)="onFilesSelected($event)"
                  multiple>
                <!-- Preview Area -->
                <div class="flex gap-4 mt-4 overflow-x-auto border border-gray-300 rounded-lg p-4 bg-gray-50"
                  style="scrollbar-width: thin;">
                  <div *ngFor="let img of imageUrls; let i = index"
                    class="relative flex-shrink-0 w-32 h-32 rounded-lg overflow-hidden border border-gray-400 shadow-md group">
                    <img [src]="img" alt="preview" class="w-full h-full object-contain" />

                    <!-- ปุ่มลบโผล่ตอน hover -->
                    <button type="button" (click)="removeImage(i)"
                      class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                      title="Remove Image">
                      ✕
                    </button>
                  </div>

                  <!-- ถ้าไม่มีรูป -->
                  <div *ngIf="imageUrls.length === 0" class=" text-gray-400 italic">
                    No images selected yet
                  </div>
                </div>
              </div>
              <input class="input input-bordered w-full" type="text" placeholder="Title"
                [(ngModel)]="pokemonObject.name" name="name" required #nameInput="ngModel">
              <div *ngIf="nameInput.invalid && nameInput.touched" class="self-start text-red-500 text-sm">
                Title is required
              </div>

              <!-- Description -->
              <textarea class="textarea textarea-bordered w-full" placeholder="Description"
                [(ngModel)]="pokemonObject.des" name="description" required #descriptionInput="ngModel"></textarea>
              <div *ngIf="descriptionInput.invalid && descriptionInput.touched" class="self-start text-red-500 text-sm">
                Description is required
              </div>

              <!-- Quantity -->
              <input class="input input-bordered w-full" type="text" placeholder="Quantity"
                [(ngModel)]="pokemonObject.quantity" name="quantity" required pattern="^[0-9]+$"
                #quantityInput="ngModel">
              <div *ngIf="quantityInput.invalid && quantityInput.touched" class="self-start text-red-500 text-sm">
                <span *ngIf="quantityInput.errors?.['required']">Quantity is required</span>
                <span *ngIf="quantityInput.errors?.['pattern']">Quantity must be a number only</span>
              </div>
              <!-- Author -->
              <input class="input input-bordered w-full" type="text" placeholder="Author"
                [(ngModel)]="pokemonObject.author" name="author" required #authorInput="ngModel">
              <div *ngIf="authorInput.invalid && authorInput.touched" class="self-start text-red-500 text-sm">
                Author is required
              </div>
              <!-- Pages -->
              <input class="input input-bordered w-full" type="text" placeholder="Pages (enter only number)"
                [(ngModel)]="pokemonObject.pages" name="pages" required pattern="^[0-9]+$" #pagesInput="ngModel">
              <div *ngIf="pagesInput.invalid && pagesInput.touched" class="text-red-500 text-sm">
                <span *ngIf="pagesInput.errors?.['required']">Pages is required</span>
                <span *ngIf="pagesInput.errors?.['pattern']">Pages must be a number only</span>
              </div>

            </div>
            <div class="flex flex-col gap-5">
              <div class="form-control">
                <select class="select select-bordered w-full" [(ngModel)]="pokemonObject.condition" name="condition"
                  required #conditionInput="ngModel">
                  <option value="" disabled selected>Select condition</option>
                  <option value="Like New">Like New</option>
                  <option value="Very Good">Very Good</option>
                  <option value="Good">Good</option>
                  <option value="Acceptable">Acceptable</option>
                  <option value="Poor">Poor</option>
                </select>
                <div *ngIf="conditionInput.invalid && conditionInput.touched" class="text-red-500 text-sm mt-1">
                  Condition is required
                </div>
              </div>
              <!-- Wrap ทั้งปุ่มและ dropdown content -->
              <div class="form-control w-full relative genre-dropdown">
                <!-- Toggle Button -->
                <button type="button" class="btn btn-outline w-full justify-between" (click)="toggleGenreDropdown()">
                  {{ pokemonObject.genre.length > 0 ? pokemonObject.genre.join(', ') : 'Select genres' }}
                  <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>

                <!-- Dropdown List -->
                <div *ngIf="genreDropdownOpen"
                  class="absolute z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-md max-h-60 overflow-y-auto w-full p-3 space-y-2">
                  <label *ngFor="let genre of genreOptions" class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="checkbox checkbox-sm" [checked]="pokemonObject.genre.includes(genre)"
                      (change)="onGenreCheckboxChange($event, genre)" />
                    <span class="text-sm">{{ genre }}</span>
                  </label>
                </div>
              </div>
              <!-- Error message if no genre selected -->
              <p *ngIf="formSubmitted && pokemonObject.genre.length === 0" class="text-sm text-red-500 mt-1">
                Please select at least one genre.
              </p>

              <!-- Price -->
              <input class="input input-bordered w-full" type="text" placeholder="Price (enter only number)"
                [(ngModel)]="pokemonObject.price" name="price" required pattern="^[0-9]+$" #priceInput="ngModel">
              <div *ngIf="priceInput.invalid && priceInput.touched" class="text-red-500 text-sm">
                <span *ngIf="priceInput.errors?.['required']">Price is required</span>
                <span *ngIf="priceInput.errors?.['pattern']">Price must be a number only</span>
              </div>


              <!-- Publication Year -->
              <input class="input input-bordered w-full" type="text" placeholder="Publication Year"
                [(ngModel)]="pokemonObject.publicationYear" name="publicationYear" required #publicationInput="ngModel">
              <div *ngIf="publicationInput.invalid && publicationInput.touched" class="text-red-500 text-sm">
                Publication year is required
              </div>


              <!-- Translator -->
              <input class="input input-bordered w-full" type="text" placeholder="Translator"
                [(ngModel)]="pokemonObject.translator" name="translator" required #translatorInput="ngModel">
              <div *ngIf="translatorInput.invalid && translatorInput.touched" class="text-red-500 text-sm">
                Translator is required
              </div>

              <!-- Publisher -->
              <input class="input input-bordered w-full" type="text" placeholder="Publisher"
                [(ngModel)]="pokemonObject.publisher" name="publisher" required #publisherInput="ngModel">
              <div *ngIf="publisherInput.invalid && publisherInput.touched" class="text-red-500 text-sm">
                Publisher is required
              </div>

              <!-- ISBN -->
              <input class="input input-bordered w-full" type="text" placeholder="ISBN number"
                [(ngModel)]="pokemonObject.isbn" name="isbn" required #isbnInput="ngModel">
              <div *ngIf="isbnInput.invalid && isbnInput.touched" class="text-red-500 text-sm">
                ISBN is required
              </div>


              <div class="flex self-end gap-4">
                <button type="button" class="btn btn-outline" (click)="clearForm();">Clear form</button>
                <button class="btn btn-neutral shadow-lg hover:shadow-xl transition-all" (click)="handleAddClick()" [disabled]="formRef.invalid" type="submit">
                  Add
                </button>
                

              </div>
            </div>
          </div>
        </form>

      </div>
    </div>
  </main>
  <div class="toast toast-top toast-end z-50 fixed right-4 top-4" *ngIf="toastMessage">
    <div [ngClass]="toastType === 'success' 
                  ? 'bg-green-500' 
                  : 'bg-red-500'" class="text-white px-4 py-3 rounded-lg shadow-lg font-medium max-w-xs">
      {{ toastMessage }}
    </div>
  </div>

</section>